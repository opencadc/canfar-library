{
  "$defs": {
    "Build": {
      "additionalProperties": false,
      "description": "Configuration for building the container image.",
      "properties": {
        "path": {
          "default": ".",
          "description": "Directory containing the Dockerfile.",
          "examples": [
            ".",
            "images/base"
          ],
          "title": "Path",
          "type": "string"
        },
        "dockerfile": {
          "default": "Dockerfile",
          "description": "Dockerfile.",
          "examples": [
            "Dockerfile",
            "base.Dockerfile"
          ],
          "title": "Dockerfile",
          "type": "string"
        },
        "context": {
          "default": ".",
          "description": "Build context relative to path.",
          "examples": [
            ".",
            "../"
          ],
          "title": "Build Context",
          "type": "string"
        },
        "builder": {
          "default": "buildkit",
          "description": "Builder backend used for this entry.",
          "examples": [
            "buildkit"
          ],
          "title": "Build Backend",
          "type": "string"
        },
        "platforms": {
          "default": [
            "linux/amd64"
          ],
          "description": "Target platforms.",
          "examples": [
            [
              "linux/amd64"
            ],
            [
              "linux/amd64",
              "linux/arm64"
            ]
          ],
          "items": {
            "enum": [
              "linux/amd64",
              "linux/arm64",
              "linux/arm/v7",
              "linux/arm/v6",
              "linux/arm/v5",
              "windows/amd64"
            ],
            "type": "string"
          },
          "title": "Target Platforms",
          "type": "array"
        },
        "tags": {
          "description": "Image tags.",
          "examples": [
            "latest",
            "1.0.0"
          ],
          "items": {
            "type": "string"
          },
          "title": "Container Image Tags",
          "type": "array"
        },
        "args": {
          "anyOf": [
            {
              "additionalProperties": {
                "type": "string"
              },
              "type": "object"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Build-time variables.",
          "examples": [
            {
              "FOO": "bar"
            }
          ],
          "title": "Build Args"
        },
        "annotations": {
          "anyOf": [
            {
              "additionalProperties": {
                "type": "string"
              },
              "type": "object"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Annotations for the image.",
          "examples": [
            {
              "canfar.image.type": "base"
            }
          ],
          "title": "Image Annotations"
        },
        "labels": {
          "anyOf": [
            {
              "additionalProperties": {
                "type": "string"
              },
              "type": "object"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Labels for the image.",
          "examples": [
            {
              "org.opencontainers.image.description": "Base image for CANFAR Science Platform",
              "org.opencontainers.image.title": "CANFAR Base Image"
            }
          ],
          "title": "Image Labels"
        },
        "target": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Target stage to build.",
          "examples": [
            "runtime"
          ],
          "title": "Build Target"
        },
        "test": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Test cmd to verify the image.",
          "examples": [
            "bash -c 'echo hello world'",
            "bash -c ./test.sh"
          ],
          "title": "Test Command"
        }
      },
      "required": [
        "tags"
      ],
      "title": "Build",
      "type": "object"
    },
    "Git": {
      "additionalProperties": false,
      "description": "Repository information for the image build source.",
      "properties": {
        "repo": {
          "description": "git repo",
          "examples": [
            "https://github.com/opencadc/canfar-library"
          ],
          "format": "uri",
          "minLength": 1,
          "title": "Repository",
          "type": "string"
        },
        "tag": {
          "description": "git tag",
          "examples": [
            "refs/tags/v1.0.0",
            "v1.0.0"
          ],
          "title": "Git Tag Reference",
          "type": "string"
        }
      },
      "required": [
        "repo",
        "tag"
      ],
      "title": "Git",
      "type": "object"
    },
    "Maintainer": {
      "additionalProperties": false,
      "description": "Details about the maintainer of the image.",
      "properties": {
        "name": {
          "description": "Name of the maintainer.",
          "title": "Name",
          "type": "string"
        },
        "email": {
          "description": "Contact email.",
          "title": "Email",
          "type": "string"
        },
        "github": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Github Username.",
          "title": "Github Username"
        },
        "gitlab": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Gitlab Username.",
          "title": "Gitlab Username"
        }
      },
      "required": [
        "name",
        "email"
      ],
      "title": "Maintainer",
      "type": "object"
    },
    "Metadata": {
      "description": "Metadata for the image.",
      "properties": {
        "identifier": {
          "description": "Unique science identifier for the image.",
          "title": "Identifier",
          "type": "string"
        },
        "project": {
          "description": "SRCnet Project name for the image.",
          "title": "Project",
          "type": "string"
        }
      },
      "required": [
        "identifier",
        "project"
      ],
      "title": "Metadata",
      "type": "object"
    }
  },
  "$id": "https://raw.githubusercontent.com/opencadc/canfar-library/main/.spec.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "additionalProperties": false,
  "description": "Schema to capture ownership, build source, intent, and identity for library artifacts.",
  "properties": {
    "name": {
      "description": "Image name.",
      "examples": [
        "astroml"
      ],
      "title": "Name",
      "type": "string"
    },
    "maintainers": {
      "description": "Image maintainers.",
      "items": {
        "$ref": "#/$defs/Maintainer"
      },
      "title": "Maintainers",
      "type": "array"
    },
    "git": {
      "$ref": "#/$defs/Git",
      "description": "Image repository.",
      "title": "Git Info"
    },
    "build": {
      "$ref": "#/$defs/Build",
      "description": "Image build info.",
      "title": "Build Info"
    },
    "metadata": {
      "$ref": "#/$defs/Metadata",
      "description": "Image metadata."
    }
  },
  "required": [
    "name",
    "maintainers",
    "git",
    "build",
    "metadata"
  ],
  "title": "CANFAR Library Manifest",
  "type": "object"
}
